{
  "$schema": "../../../.cleo/schemas/tasks.schema.json",
  "phase": "11-mcp-server",
  "name": "MCP Server",
  "priority": "P0",
  "lastTaskId": 87,
  "tasks": [
    {
      "id": "T043",
      "plan": "11-01",
      "wave": 1,
      "name": "Create MCP types",
      "description": "Create shared TypeScript types for MCP protocol (MCPRequest, MCPResponse, ToolDefinition, MCPError)",
      "file": "lib/mcp/types.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": [],
      "leverage": 9.0
    },
    {
      "id": "T044",
      "plan": "11-01",
      "wave": 1,
      "name": "Create MCP protocol handler",
      "description": "Implement MCPServer class with handleRequest(), listTools(), callTool() methods for JSON-RPC 2.0",
      "file": "lib/mcp/server.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T043"],
      "leverage": 9.5
    },
    {
      "id": "T045",
      "plan": "11-01",
      "wave": 1,
      "name": "Create tool registry",
      "description": "Implement tool registration system with registerTool(), getTool(), listTools() functions",
      "file": "lib/mcp/tool-registry.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T043"],
      "leverage": 9.0
    },
    {
      "id": "T046",
      "plan": "11-01",
      "wave": 1,
      "name": "Create main MCP route",
      "description": "Create POST handler for /api/mcp/[projectId] that routes JSON-RPC requests to MCPServer",
      "file": "app/api/mcp/[projectId]/route.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T044", "T045"],
      "leverage": 9.0
    },
    {
      "id": "T047",
      "plan": "11-01",
      "wave": 1,
      "name": "Add MCP server tests",
      "description": "Test JSON-RPC parsing, tools/list, tools/call routing, error handling",
      "file": "lib/mcp/__tests__/server.test.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T046"],
      "leverage": 7.5
    },
    {
      "id": "T048",
      "plan": "11-02",
      "wave": 1,
      "name": "Add project_api_keys table schema",
      "description": "Add pgTable for project_api_keys with id, projectId, name, keyHash, keyPrefix, lastUsedAt, createdAt, revokedAt",
      "file": "lib/db/schema.ts",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": [],
      "leverage": 8.5
    },
    {
      "id": "T049",
      "plan": "11-02",
      "wave": 1,
      "name": "Create API keys migration",
      "description": "Generate and apply migration for project_api_keys table",
      "file": "lib/db/migrations/0006_project_api_keys.sql",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": ["T048"],
      "leverage": 8.0
    },
    {
      "id": "T050",
      "plan": "11-02",
      "wave": 1,
      "name": "Create key generation utilities",
      "description": "Implement generateApiKey(), validateApiKey(), hashApiKey() functions",
      "file": "lib/mcp/auth.ts",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": ["T049"],
      "leverage": 9.0
    },
    {
      "id": "T051",
      "plan": "11-02",
      "wave": 1,
      "name": "Create key management API routes",
      "description": "Create GET/POST /api/projects/[id]/keys and DELETE /api/projects/[id]/keys/[keyId]",
      "file": "app/api/projects/[id]/keys/route.ts",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": ["T050"],
      "leverage": 8.5
    },
    {
      "id": "T052",
      "plan": "11-02",
      "wave": 1,
      "name": "Add rate limiting",
      "description": "Implement checkRateLimit() for 100 req/min per key using in-memory store",
      "file": "lib/mcp/rate-limit.ts",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": ["T050"],
      "leverage": 7.0
    },
    {
      "id": "T053",
      "plan": "11-02",
      "wave": 1,
      "name": "Add auth tests",
      "description": "Test key generation, validation, rate limiting, and API routes",
      "file": "lib/mcp/__tests__/auth.test.ts",
      "status": "pending",
      "agent": "devops-engineer",
      "dependencies": ["T051", "T052"],
      "leverage": 7.0
    },
    {
      "id": "T054",
      "plan": "11-03",
      "wave": 1,
      "name": "Create core tools structure",
      "description": "Create app/api/mcp/tools/core/ directory with index.ts exporting all tools",
      "file": "app/api/mcp/tools/core/index.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T045"],
      "leverage": 7.0
    },
    {
      "id": "T055",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_prd tool",
      "description": "Return full PRD with optional section filter (problem, actors, use_cases, scope, goals)",
      "file": "app/api/mcp/tools/core/get-prd.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.5
    },
    {
      "id": "T056",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_database_schema tool",
      "description": "Return entities with fields, types, relationships from projectData.dataEntities",
      "file": "app/api/mcp/tools/core/get-database-schema.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.5
    },
    {
      "id": "T057",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_tech_stack tool",
      "description": "Return tech stack choices with rationale from projectData.techStack",
      "file": "app/api/mcp/tools/core/get-tech-stack.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.0
    },
    {
      "id": "T058",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_user_stories tool",
      "description": "Return user stories with status/priority filtering support",
      "file": "app/api/mcp/tools/core/get-user-stories.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.0
    },
    {
      "id": "T059",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_coding_context tool",
      "description": "Generate MUST DO / MUST NOT DO rules from tech stack and project constraints",
      "file": "app/api/mcp/tools/core/get-coding-context.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.5
    },
    {
      "id": "T060",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_project_architecture tool",
      "description": "Return aggregated architecture overview (system type, tech stack, entities, use cases)",
      "file": "app/api/mcp/tools/core/get-project-architecture.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 8.0
    },
    {
      "id": "T061",
      "plan": "11-03",
      "wave": 1,
      "name": "Implement get_diagrams tool",
      "description": "Return Mermaid diagrams with type filter (context, use_case, class, sequence, activity, system_architecture)",
      "file": "app/api/mcp/tools/core/get-diagrams.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T054"],
      "leverage": 7.5
    },
    {
      "id": "T062",
      "plan": "11-03",
      "wave": 1,
      "name": "Register core tools",
      "description": "Add core tools to tool registry in lib/mcp/register-tools.ts",
      "file": "lib/mcp/register-tools.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T055", "T056", "T057", "T058", "T059", "T060", "T061"],
      "leverage": 8.0
    },
    {
      "id": "T063",
      "plan": "11-03",
      "wave": 1,
      "name": "Add core tools tests",
      "description": "Test each core tool with mock project data",
      "file": "app/api/mcp/tools/core/__tests__/",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T062"],
      "leverage": 7.5
    },
    {
      "id": "T064",
      "plan": "11-04",
      "wave": 2,
      "name": "Implement get_api_specs tool",
      "description": "Return API specs from projectData.apiSpecification with json/openapi format support",
      "file": "app/api/mcp/tools/generators/get-api-specs.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T062"],
      "leverage": 8.5
    },
    {
      "id": "T065",
      "plan": "11-04",
      "wave": 2,
      "name": "Implement get_infrastructure tool",
      "description": "Return infrastructure spec with section filter (hosting, database, caching, cicd, monitoring, security)",
      "file": "app/api/mcp/tools/generators/get-infrastructure.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T062"],
      "leverage": 8.0
    },
    {
      "id": "T066",
      "plan": "11-04",
      "wave": 2,
      "name": "Implement get_coding_guidelines tool",
      "description": "Return coding guidelines with section filter (naming, patterns, linting, testing, documentation)",
      "file": "app/api/mcp/tools/generators/get-coding-guidelines.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T062"],
      "leverage": 8.0
    },
    {
      "id": "T067",
      "plan": "11-04",
      "wave": 2,
      "name": "Implement update_user_story_status tool",
      "description": "Update story status (todo, in-progress, done, stuck) with optional notes",
      "file": "app/api/mcp/tools/generators/update-story-status.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T062"],
      "leverage": 7.5
    },
    {
      "id": "T068",
      "plan": "11-04",
      "wave": 2,
      "name": "Register generator tools",
      "description": "Add generator tools to tool registry",
      "file": "lib/mcp/register-tools.ts",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T064", "T065", "T066", "T067"],
      "leverage": 7.0
    },
    {
      "id": "T069",
      "plan": "11-04",
      "wave": 2,
      "name": "Add generator tools tests",
      "description": "Test generator tools with mock data",
      "file": "app/api/mcp/tools/generators/__tests__/",
      "status": "pending",
      "agent": "backend-architect",
      "dependencies": ["T068"],
      "leverage": 7.0
    },
    {
      "id": "T070",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement get_validation_status tool",
      "description": "Return PRD-SPEC validation score and check results with verbose option",
      "file": "app/api/mcp/tools/unique/get-validation-status.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 9.0
    },
    {
      "id": "T071",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement get_gsd_phases tool",
      "description": "Return GSD workflow phases from .planning/ROADMAP.md or project config",
      "file": "app/api/mcp/tools/unique/get-gsd-phases.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 7.5
    },
    {
      "id": "T072",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement get_cleo_tasks tool",
      "description": "Return CLEO-tracked tasks with stable IDs, status/phase filtering",
      "file": "app/api/mcp/tools/unique/get-cleo-tasks.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 8.0
    },
    {
      "id": "T073",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement invoke_agent tool",
      "description": "Invoke one of 17 specialized domain agents with task description and context",
      "file": "app/api/mcp/tools/unique/invoke-agent.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 9.5
    },
    {
      "id": "T074",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement ask_project_question tool",
      "description": "RAG-powered Q&A about the project using project data as context",
      "file": "app/api/mcp/tools/unique/ask-question.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 8.5
    },
    {
      "id": "T075",
      "plan": "11-05",
      "wave": 2,
      "name": "Implement search_project_context tool",
      "description": "Keyword/semantic search across project data with type filter and limit",
      "file": "app/api/mcp/tools/unique/search-context.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T062"],
      "leverage": 8.0
    },
    {
      "id": "T076",
      "plan": "11-05",
      "wave": 2,
      "name": "Register unique tools",
      "description": "Add unique tools to tool registry",
      "file": "lib/mcp/register-tools.ts",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T070", "T071", "T072", "T073", "T074", "T075"],
      "leverage": 7.5
    },
    {
      "id": "T077",
      "plan": "11-05",
      "wave": 2,
      "name": "Add unique tools tests",
      "description": "Test unique tools including agent invocation and search",
      "file": "app/api/mcp/tools/unique/__tests__/",
      "status": "pending",
      "agent": "langchain-engineer",
      "dependencies": ["T076"],
      "leverage": 7.0
    },
    {
      "id": "T078",
      "plan": "11-06",
      "wave": 3,
      "name": "Create connections page",
      "description": "Create /projects/[id]/connections page with header, integration cards, key management, exports",
      "file": "app/(dashboard)/projects/[id]/connections/page.tsx",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T051", "T068", "T076"],
      "leverage": 8.5
    },
    {
      "id": "T079",
      "plan": "11-06",
      "wave": 3,
      "name": "Create integration cards component",
      "description": "Cards for Claude Code, Cursor, VS Code, Windsurf with setup commands",
      "file": "components/connections/integration-cards.tsx",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T078"],
      "leverage": 8.0
    },
    {
      "id": "T080",
      "plan": "11-06",
      "wave": 3,
      "name": "Create API key management UI",
      "description": "List keys, create new key modal, revoke confirmation, connection status",
      "file": "components/connections/api-key-management.tsx",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T078"],
      "leverage": 8.0
    },
    {
      "id": "T081",
      "plan": "11-06",
      "wave": 3,
      "name": "Create SKILL.md generator",
      "description": "Generate project-specific SKILL.md with tools, guidelines, quick reference",
      "file": "lib/mcp/skill-generator.ts",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T068", "T076"],
      "leverage": 8.5
    },
    {
      "id": "T082",
      "plan": "11-06",
      "wave": 3,
      "name": "Create CLAUDE.md generator",
      "description": "Generate shorter CLAUDE.md for quick reference",
      "file": "lib/mcp/claude-md-generator.ts",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T081"],
      "leverage": 7.5
    },
    {
      "id": "T083",
      "plan": "11-06",
      "wave": 3,
      "name": "Create config generator route",
      "description": "GET /api/mcp/config with client query param for config JSON",
      "file": "app/api/mcp/config/route.ts",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T046"],
      "leverage": 7.0
    },
    {
      "id": "T084",
      "plan": "11-06",
      "wave": 3,
      "name": "Create export download routes",
      "description": "GET routes for /exports/skill and /exports/claude-md with file download",
      "file": "app/api/projects/[id]/exports/",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T081", "T082"],
      "leverage": 7.0
    },
    {
      "id": "T085",
      "plan": "11-06",
      "wave": 3,
      "name": "Add copy-to-clipboard commands",
      "description": "Reusable copy button component with toast confirmation",
      "file": "components/connections/copy-command.tsx",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T079"],
      "leverage": 6.5
    },
    {
      "id": "T086",
      "plan": "11-06",
      "wave": 3,
      "name": "Add connection status indicator",
      "description": "Show MCP connection status based on lastUsedAt (green/yellow/gray)",
      "file": "components/connections/connection-status.tsx",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T080"],
      "leverage": 6.0
    },
    {
      "id": "T087",
      "plan": "11-06",
      "wave": 3,
      "name": "Add UI tests",
      "description": "Test connections page, components, and generators",
      "file": "components/connections/__tests__/",
      "status": "pending",
      "agent": "ui-ux-engineer",
      "dependencies": ["T084", "T085", "T086"],
      "leverage": 7.0
    }
  ],
  "summary": {
    "total": 45,
    "byWave": {
      "1": 21,
      "2": 14,
      "3": 10
    },
    "byPlan": {
      "11-01": 5,
      "11-02": 6,
      "11-03": 10,
      "11-04": 6,
      "11-05": 8,
      "11-06": 10
    },
    "byAgent": {
      "backend-architect": 21,
      "devops-engineer": 6,
      "langchain-engineer": 8,
      "ui-ux-engineer": 10
    }
  }
}
