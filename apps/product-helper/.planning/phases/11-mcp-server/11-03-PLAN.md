---
plan: 11-03
name: Core MCP Tools
wave: 1
autonomous: true
subsystem: api
agent: backend-architect
---

# Plan 11-03: Core MCP Tools (7 tools)

## Objective

Implement the 7 core MCP tools that serve existing project data (no generation needed).

## Tools to Implement

| Tool | Returns | Source |
|------|---------|--------|
| `get_prd` | Full PRD document | `projectData` fields |
| `get_database_schema` | Entities, fields, relations | `projectData.dataEntities` |
| `get_tech_stack` | Tech choices + rationale | `projectData.techStack` |
| `get_user_stories` | Stories with status | `user_stories` table |
| `get_coding_context` | MUST DO / MUST NOT DO | Generated from project |
| `get_project_architecture` | Full architecture overview | Aggregated view |
| `get_diagrams` | Mermaid diagrams | `lib/diagrams/generators.ts` |

## Tasks

### Task 1: Create Tool Base Structure

**File:** `app/api/mcp/tools/core/index.ts`

```typescript
// Export all core tools
export * from './get-prd';
export * from './get-database-schema';
// ... etc
```

### Task 2: Implement get_prd Tool

**File:** `app/api/mcp/tools/core/get-prd.ts`

```typescript
export const getPrdTool: ToolHandler = {
  definition: {
    name: 'get_prd',
    description: 'Get the full Product Requirements Document including problem, actors, use cases, and scope',
    inputSchema: {
      type: 'object',
      properties: {
        section: {
          type: 'string',
          enum: ['full', 'problem', 'actors', 'use_cases', 'scope', 'goals'],
          description: 'Specific section to retrieve (default: full)'
        }
      }
    }
  },
  execute: async (args, projectId) => { /* ... */ }
};
```

### Task 3: Implement get_database_schema Tool

**File:** `app/api/mcp/tools/core/get-database-schema.ts`

Returns entities with fields, types, relationships from `projectData.dataEntities`.

### Task 4: Implement get_tech_stack Tool

**File:** `app/api/mcp/tools/core/get-tech-stack.ts`

Returns tech stack choices with rationale from `projectData.techStack`.

### Task 5: Implement get_user_stories Tool

**File:** `app/api/mcp/tools/core/get-user-stories.ts`

```typescript
// Supports filtering by status/priority
inputSchema: {
  properties: {
    status: { enum: ['all', 'todo', 'in-progress', 'done'] },
    priority: { enum: ['all', 'critical', 'high', 'medium', 'low'] }
  }
}
```

### Task 6: Implement get_coding_context Tool

**File:** `app/api/mcp/tools/core/get-coding-context.ts`

Generates MUST DO / MUST NOT DO rules based on:
- Tech stack (e.g., "MUST use TypeScript strict mode")
- Project constraints
- Coding guidelines (if generated)

### Task 7: Implement get_project_architecture Tool

**File:** `app/api/mcp/tools/core/get-project-architecture.ts`

Returns aggregated overview:
- System type
- Tech stack summary
- Key entities
- Main use cases
- Architecture decisions

### Task 8: Implement get_diagrams Tool

**File:** `app/api/mcp/tools/core/get-diagrams.ts`

```typescript
inputSchema: {
  properties: {
    type: {
      enum: ['context', 'use_case', 'class', 'sequence', 'activity', 'system_architecture', 'all']
    },
    format: { enum: ['mermaid', 'svg'] }
  }
}
```

### Task 9: Register Tools

**File:** `lib/mcp/register-tools.ts`

```typescript
// Register all tools with the registry
import * as coreTools from '@/app/api/mcp/tools/core';

export function registerAllTools() {
  Object.values(coreTools).forEach(tool => {
    registerTool(tool);
  });
}
```

### Task 10: Add Tests

**File:** `app/api/mcp/tools/core/__tests__/`

Test each tool with mock project data.

## Dependencies

- 11-01 (MCP Framework) - needs tool registry

## Deliverables

- [ ] 7 core tools implemented
- [ ] All tools registered with MCP server
- [ ] Tests pass for each tool
