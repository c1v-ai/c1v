---
plan: 11-04
name: Generator-Based MCP Tools
wave: 2
autonomous: true
subsystem: api
agent: backend-architect
---

# Plan 11-04: Generator-Based MCP Tools (4 tools)

## Objective

Implement MCP tools that serve data from Phase 10 generators (API specs, infrastructure, guidelines).

## Tools to Implement

| Tool | Returns | Source |
|------|---------|--------|
| `get_api_specs` | API endpoint contracts | `projectData.apiSpecification` |
| `get_infrastructure` | Deployment/CI/CD config | `projectData.infrastructureSpec` |
| `get_coding_guidelines` | Code standards | `projectData.codingGuidelines` |
| `update_user_story_status` | Updated story | `user_stories` table |

## Tasks

### Task 1: Implement get_api_specs Tool

**File:** `app/api/mcp/tools/generators/get-api-specs.ts`

```typescript
export const getApiSpecsTool: ToolHandler = {
  definition: {
    name: 'get_api_specs',
    description: 'Get API endpoint specifications including paths, methods, request/response schemas',
    inputSchema: {
      type: 'object',
      properties: {
        format: {
          type: 'string',
          enum: ['json', 'openapi'],
          description: 'Output format (default: json)'
        },
        endpoint: {
          type: 'string',
          description: 'Filter to specific endpoint path'
        }
      }
    }
  },
  execute: async (args, projectId) => {
    // Return from projectData.apiSpecification
    // If format=openapi, convert using api-spec-openapi-export.ts
  }
};
```

### Task 2: Implement get_infrastructure Tool

**File:** `app/api/mcp/tools/generators/get-infrastructure.ts`

```typescript
inputSchema: {
  properties: {
    section: {
      enum: ['full', 'hosting', 'database', 'caching', 'cicd', 'monitoring', 'security']
    }
  }
}
```

### Task 3: Implement get_coding_guidelines Tool

**File:** `app/api/mcp/tools/generators/get-coding-guidelines.ts`

```typescript
inputSchema: {
  properties: {
    section: {
      enum: ['full', 'naming', 'patterns', 'forbidden', 'linting', 'testing', 'documentation']
    }
  }
}
```

### Task 4: Implement update_user_story_status Tool

**File:** `app/api/mcp/tools/generators/update-story-status.ts`

```typescript
export const updateStoryStatusTool: ToolHandler = {
  definition: {
    name: 'update_user_story_status',
    description: 'Update the status of a user story (todo, in-progress, done, stuck)',
    inputSchema: {
      type: 'object',
      properties: {
        storyId: { type: 'string', description: 'Story ID to update' },
        status: { enum: ['todo', 'in-progress', 'done', 'stuck'] },
        notes: { type: 'string', description: 'Optional status notes' }
      },
      required: ['storyId', 'status']
    }
  },
  execute: async (args, projectId) => {
    // Update user_stories table
    // Return updated story
  }
};
```

### Task 5: Register Tools

**File:** `lib/mcp/register-tools.ts` (modify)

Add generator tools to registration.

### Task 6: Add Tests

**File:** `app/api/mcp/tools/generators/__tests__/`

## Dependencies

- 11-01 (MCP Framework)
- Phase 10 agents for generated data

## Deliverables

- [ ] 4 generator tools implemented
- [ ] OpenAPI export working for api_specs
- [ ] Story status updates working
- [ ] Tests pass
