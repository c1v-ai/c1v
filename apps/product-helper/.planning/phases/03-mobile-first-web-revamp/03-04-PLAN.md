---
phase: 03-mobile-first-web-revamp
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/globals.css
  - app/theme.css
  - components/chat/chat-window.tsx
  - components/chat/chat-input.tsx
autonomous: true
subsystem: mobile
agent: ui-ux-engineer

must_haves:
  truths:
    - "Mobile users have appropriately sized touch targets (>= 44px)"
    - "Typography is readable on mobile without zooming"
    - "Chat input is usable on mobile keyboards"
    - "Spacing follows consistent mobile-first system"
  artifacts:
    - path: "app/globals.css"
      provides: "Mobile-first spacing and typography utilities"
      contains: "@layer utilities"
    - path: "components/chat/chat-window.tsx"
      provides: "Mobile-optimized chat message display"
      min_lines: 50
    - path: "components/chat/chat-input.tsx"
      provides: "Mobile-optimized chat input with keyboard handling"
      min_lines: 30
  key_links:
    - from: "components/chat/chat-input.tsx"
      to: "mobile keyboard"
      via: "input focus and viewport handling"
      pattern: "inputMode|enterKeyHint"
---

<objective>
Implement mobile-first design system updates for spacing, typography, and touch targets.

Purpose: Ensure all interactive elements meet mobile usability standards (44px touch targets per Apple HIG), typography is readable, and the chat interface works well with mobile keyboards.

Output:
- Mobile-first spacing scale in CSS
- Touch target utilities
- Chat component mobile optimizations
- Typography adjustments for mobile readability
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-1.1.md
@.planning/STATE.md
@.planning/phases/03-mobile-first-web-revamp/03-RESEARCH.md
@.planning/phases/03-mobile-first-web-revamp/03-01-SUMMARY.md

# Files to modify
@app/globals.css
@app/theme.css
@components/chat/chat-window.tsx
@components/chat/chat-input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mobile-first design utilities to CSS</name>
  <files>
    app/globals.css
    app/theme.css
  </files>
  <action>
1. Update `app/globals.css` - add mobile-first utilities in the @layer utilities section:

```css
@layer utilities {
  /* ... existing utilities ... */

  /* Mobile-first touch target utilities */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }

  .touch-target-sm {
    min-height: 36px;
    min-width: 36px;
  }

  .touch-target-lg {
    min-height: 48px;
    min-width: 48px;
  }

  /* Mobile-first spacing scale */
  .space-mobile {
    --space-xs: 0.25rem;  /* 4px */
    --space-sm: 0.5rem;   /* 8px */
    --space-md: 1rem;     /* 16px */
    --space-lg: 1.5rem;   /* 24px */
    --space-xl: 2rem;     /* 32px */
  }

  @media (min-width: 768px) {
    .space-mobile {
      --space-xs: 0.5rem;   /* 8px */
      --space-sm: 0.75rem;  /* 12px */
      --space-md: 1.25rem;  /* 20px */
      --space-lg: 2rem;     /* 32px */
      --space-xl: 3rem;     /* 48px */
    }
  }

  /* Safe area padding utilities (iOS) */
  .safe-top {
    padding-top: env(safe-area-inset-top);
  }

  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .safe-left {
    padding-left: env(safe-area-inset-left);
  }

  .safe-right {
    padding-right: env(safe-area-inset-right);
  }

  .safe-x {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  .safe-y {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }

  .safe-all {
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }

  /* Mobile typography scale */
  .text-mobile-base {
    font-size: 16px; /* Prevents iOS zoom on focus */
    line-height: 1.5;
  }

  .text-mobile-sm {
    font-size: 14px;
    line-height: 1.4;
  }

  .text-mobile-lg {
    font-size: 18px;
    line-height: 1.5;
  }

  /* Prevent text selection on interactive elements */
  .no-select {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  /* Improve tap highlight */
  .tap-highlight-none {
    -webkit-tap-highlight-color: transparent;
  }
}
```

2. Update `app/theme.css` - ensure form inputs have proper mobile sizing:

After the existing input styles, add:
```css
/* Mobile-optimized form inputs */
input, textarea, select {
  font-size: 16px; /* Prevents iOS zoom on focus */
}

@media (max-width: 767px) {
  input, textarea, select {
    padding: 12px 14px; /* Larger touch targets on mobile */
  }

  button, .btn, .button {
    min-height: 44px; /* Touch target minimum */
    padding: 12px 16px;
  }
}
```
  </action>
  <verify>
    - CSS files compile without errors: `npm run dev`
    - Utility classes available in DevTools
    - On mobile, form inputs don't trigger iOS zoom when focused
  </verify>
  <done>Mobile-first CSS utilities for touch targets, spacing, safe areas, and typography</done>
</task>

<task type="auto">
  <name>Task 2: Optimize chat input for mobile keyboards</name>
  <files>
    components/chat/chat-input.tsx
  </files>
  <action>
Read the current chat-input.tsx file and enhance it with mobile optimizations:

1. Add `inputMode="text"` for better mobile keyboard
2. Add `enterKeyHint="send"` for send button on mobile keyboard
3. Ensure minimum height for touch target (44px)
4. Add proper viewport handling to avoid keyboard overlap
5. Use `font-size: 16px` to prevent iOS auto-zoom

Update the input/textarea element with these attributes:
```typescript
<textarea
  // ... existing props
  inputMode="text"
  enterKeyHint="send"
  className={cn(
    "...",
    "text-base", // 16px base - prevents iOS zoom
    "min-h-[44px]", // Touch target
    "resize-none" // Prevent resize handle on mobile
  )}
  style={{
    fontSize: '16px', // Explicit to prevent iOS zoom
  }}
  onKeyDown={(e) => {
    // Submit on Enter (without Shift) on mobile
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit();
    }
  }}
/>
```

Also ensure the send button has proper touch target:
```typescript
<Button
  type="submit"
  className="touch-target" // 44px minimum
  // or explicit: className="min-h-[44px] min-w-[44px]"
>
  Send
</Button>
```

If the component uses a form, ensure proper handling:
```typescript
<form
  onSubmit={handleSubmit}
  className="flex gap-2 items-end p-2 md:p-4"
>
  {/* input and button */}
</form>
```

IMPORTANT: The `text-base` class (16px) is critical - iOS Safari auto-zooms on inputs with font-size < 16px.
  </action>
  <verify>
    - `npm run dev` succeeds
    - On mobile viewport:
      - Input doesn't zoom when focused (font-size >= 16px)
      - Mobile keyboard shows "Send" or "Go" button
      - Enter key submits message
      - Send button is easily tappable (>= 44px)
  </verify>
  <done>Chat input optimized for mobile with proper keyboard hints and touch targets</done>
</task>

<task type="auto">
  <name>Task 3: Optimize chat window for mobile display</name>
  <files>
    components/chat/chat-window.tsx
  </files>
  <action>
Read the current chat-window.tsx and enhance for mobile:

1. Ensure proper spacing on mobile (tighter margins/padding)
2. Make message bubbles full-width on mobile, max-width on desktop
3. Ensure readable font sizes
4. Handle virtual keyboard appearance (scroll to bottom)

Key changes to apply:

For the message container:
```typescript
<div className={cn(
  "flex flex-col gap-3 p-3", // Mobile-first: smaller gap/padding
  "md:gap-4 md:p-4" // Desktop: larger spacing
)}>
  {messages.map((message) => (
    <MessageBubble key={message.id} message={message} />
  ))}
</div>
```

For message bubbles:
```typescript
<div className={cn(
  "rounded-lg p-3",
  "max-w-full", // Mobile: full width
  "md:max-w-[80%]", // Desktop: 80% width max
  isUser
    ? "bg-primary text-primary-foreground ml-auto"
    : "bg-muted mr-auto"
)}>
  <p className="text-base leading-relaxed">
    {message.content}
  </p>
</div>
```

For the scroll container, add ref handling to scroll on keyboard open:
```typescript
const scrollRef = useRef<HTMLDivElement>(null);

// Scroll to bottom when messages change or on mount
useEffect(() => {
  if (scrollRef.current) {
    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
  }
}, [messages]);

// Handle virtual keyboard on iOS
useEffect(() => {
  if (typeof window !== 'undefined' && 'visualViewport' in window) {
    const viewport = window.visualViewport;
    const handleResize = () => {
      // Scroll to bottom when keyboard appears (viewport shrinks)
      if (scrollRef.current) {
        scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
      }
    };
    viewport?.addEventListener('resize', handleResize);
    return () => viewport?.removeEventListener('resize', handleResize);
  }
}, []);

return (
  <div
    ref={scrollRef}
    className={cn(
      "flex-1 overflow-y-auto",
      "overscroll-contain", // Prevent scroll chaining on mobile
    )}
  >
    {/* messages */}
  </div>
);
```

IMPORTANT: `overscroll-contain` prevents the "rubber band" scroll from propagating to parent containers on mobile.
  </action>
  <verify>
    - `npm run dev` succeeds
    - On mobile viewport:
      - Messages use full width
      - Spacing is appropriate (not too cramped, not too spacious)
      - Font size is readable without zooming
      - When keyboard opens, chat scrolls to show latest messages
    - On desktop:
      - Messages have max-width (don't stretch full width)
      - Spacing is comfortable
  </verify>
  <done>
    - Chat window responsive with mobile-first spacing
    - Message bubbles adapt width to viewport
    - Virtual keyboard handling for iOS
    - Proper scroll behavior on both platforms
  </done>
</task>

</tasks>

<verification>
1. Touch target audit:
   - Use Chrome DevTools > More tools > Rendering > Show tap areas
   - All interactive elements should have adequate tap area

2. Typography check:
   - All text readable without pinch-zoom
   - No iOS auto-zoom on input focus

3. Chat flow test:
   - Type message on mobile
   - Keyboard appears, chat scrolls to bottom
   - Send with Enter key
   - Message appears, keyboard remains
   - Can scroll chat while keyboard open

4. Cross-device testing:
   - iOS Safari (actual device or BrowserStack)
   - Android Chrome
   - Desktop browsers
</verification>

<success_criteria>
- All interactive elements >= 44px touch target
- Form inputs don't trigger iOS zoom (font-size >= 16px)
- Chat works smoothly with mobile keyboard
- Spacing consistent and appropriate for mobile
- Safe area utilities available for components
- Typography readable on mobile without zooming
</success_criteria>

<output>
After completion, create `.planning/phases/03-mobile-first-web-revamp/03-04-SUMMARY.md`
</output>
