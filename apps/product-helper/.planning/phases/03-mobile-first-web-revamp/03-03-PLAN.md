---
phase: 03-mobile-first-web-revamp
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/navigation/bottom-nav.tsx
  - components/navigation/mobile-menu.tsx
  - app/(dashboard)/layout.tsx
  - lib/hooks/use-media-query.ts
autonomous: true
subsystem: mobile
agent: ui-ux-engineer

must_haves:
  truths:
    - "Mobile users see bottom navigation bar with 4 primary destinations"
    - "Mobile users can access hamburger menu for additional options"
    - "Bottom nav highlights current route"
    - "Desktop users see existing header navigation (no bottom nav)"
  artifacts:
    - path: "components/navigation/bottom-nav.tsx"
      provides: "Fixed bottom navigation for mobile"
      exports: ["BottomNav"]
    - path: "components/navigation/mobile-menu.tsx"
      provides: "Hamburger menu drawer for mobile"
      exports: ["MobileMenu"]
    - path: "lib/hooks/use-media-query.ts"
      provides: "Responsive breakpoint detection hook"
      exports: ["useMediaQuery", "useIsMobile"]
  key_links:
    - from: "app/(dashboard)/layout.tsx"
      to: "components/navigation/bottom-nav.tsx"
      via: "BottomNav rendered at page bottom"
      pattern: "<BottomNav"
    - from: "components/navigation/bottom-nav.tsx"
      to: "next/navigation usePathname"
      via: "Active route highlighting"
      pattern: "usePathname"
---

<objective>
Create mobile navigation with bottom nav bar and hamburger menu.

Purpose: Provide intuitive mobile navigation following established mobile app patterns (bottom nav for primary destinations, hamburger for secondary). The existing desktop nav (hidden on mobile via `hidden md:flex`) will continue to work on larger screens.

Output:
- Bottom navigation bar (visible on mobile only)
- Hamburger menu with drawer/sheet
- useMediaQuery hook for responsive logic
- Integration with existing dashboard layout
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-1.1.md
@.planning/STATE.md
@.planning/phases/03-mobile-first-web-revamp/03-RESEARCH.md
@.planning/phases/03-mobile-first-web-revamp/03-01-SUMMARY.md

# Files to modify/reference
@app/(dashboard)/layout.tsx
@components/ui/button.tsx
@components/ui/sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useMediaQuery hook</name>
  <files>
    lib/hooks/use-media-query.ts
  </files>
  <action>
Create `lib/hooks/use-media-query.ts`:

```typescript
'use client'

import { useEffect, useState } from 'react'

/**
 * Hook to detect if a media query matches
 * @param query - CSS media query string (e.g., "(max-width: 767px)")
 * @returns boolean indicating if query matches
 */
export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(false)

  useEffect(() => {
    const media = window.matchMedia(query)
    setMatches(media.matches)

    const listener = (e: MediaQueryListEvent) => setMatches(e.matches)
    media.addEventListener('change', listener)
    return () => media.removeEventListener('change', listener)
  }, [query])

  return matches
}

/**
 * Convenience hook for mobile detection
 * Uses Tailwind's md breakpoint (768px) as the threshold
 * @returns true if viewport is mobile-sized (< 768px)
 */
export function useIsMobile(): boolean {
  return useMediaQuery('(max-width: 767px)')
}

/**
 * Convenience hook for tablet detection
 * @returns true if viewport is tablet-sized (768px - 1023px)
 */
export function useIsTablet(): boolean {
  return useMediaQuery('(min-width: 768px) and (max-width: 1023px)')
}

/**
 * Convenience hook for desktop detection
 * @returns true if viewport is desktop-sized (>= 1024px)
 */
export function useIsDesktop(): boolean {
  return useMediaQuery('(min-width: 1024px)')
}
```

IMPORTANT: Initial state is `false` to avoid hydration mismatches. The hook updates after mount when window is available.
  </action>
  <verify>
    - File exists at lib/hooks/use-media-query.ts
    - Exports useMediaQuery, useIsMobile, useIsTablet, useIsDesktop
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>useMediaQuery hook created with convenience methods for common breakpoints</done>
</task>

<task type="auto">
  <name>Task 2: Create BottomNav component</name>
  <files>
    components/navigation/bottom-nav.tsx
  </files>
  <action>
Create `components/navigation/bottom-nav.tsx`:

```typescript
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { Home, FolderOpen, MessageSquare, User } from 'lucide-react'
import { cn } from '@/lib/utils'

const navItems = [
  { href: '/projects', icon: Home, label: 'Home' },
  { href: '/projects', icon: FolderOpen, label: 'Projects' },
  // Chat link will go to most recent project's chat or a default
  { href: '/chat', icon: MessageSquare, label: 'Chat' },
  { href: '/settings', icon: User, label: 'Account' },
]

export function BottomNav() {
  const pathname = usePathname()

  // Check if current path matches nav item (handles nested routes)
  const isActive = (href: string) => {
    if (href === '/projects') {
      return pathname === '/projects' || pathname === '/'
    }
    return pathname.startsWith(href)
  }

  return (
    <nav
      className={cn(
        "fixed bottom-0 left-0 right-0 z-50",
        "md:hidden", // Only show on mobile (< 768px)
        "bg-background border-t border-border",
        "pb-[env(safe-area-inset-bottom)]" // iOS safe area
      )}
    >
      <div className="flex justify-around items-center h-16">
        {navItems.map((item) => {
          const active = isActive(item.href)
          return (
            <Link
              key={item.label}
              href={item.href}
              className={cn(
                "flex flex-col items-center justify-center flex-1 h-full",
                "transition-colors duration-200",
                "min-w-[64px]", // Minimum touch target width
                active
                  ? "text-primary"
                  : "text-muted-foreground hover:text-foreground"
              )}
            >
              <item.icon
                className={cn(
                  "h-5 w-5 mb-1",
                  active && "stroke-[2.5px]" // Bolder stroke when active
                )}
              />
              <span className="text-xs font-medium">{item.label}</span>
            </Link>
          )
        })}
      </div>
    </nav>
  )
}
```

IMPORTANT:
- Uses `md:hidden` to hide on desktop (Tailwind mobile-first)
- Includes iOS safe area padding for home indicator
- Minimum touch target of 64px width (Apple HIG recommends 44pt minimum)
- Active state detection handles nested routes
  </action>
  <verify>
    - File exists at components/navigation/bottom-nav.tsx
    - Component uses usePathname for active state
    - Has md:hidden class for responsive hiding
    - Has pb-[env(safe-area-inset-bottom)] for iOS
  </verify>
  <done>BottomNav component with 4 nav items, active state, and safe area support</done>
</task>

<task type="auto">
  <name>Task 3: Create MobileMenu and integrate navigation</name>
  <files>
    components/navigation/mobile-menu.tsx
    app/(dashboard)/layout.tsx
  </files>
  <action>
1. Create `components/navigation/mobile-menu.tsx`:

```typescript
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { Menu, X, Home, FolderOpen, MessageSquare, Settings, LogOut, Moon, Sun } from 'lucide-react'
import { Button } from '@/components/ui/button'
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from '@/components/ui/sheet'
import { cn } from '@/lib/utils'
import { useTheme } from 'next-themes'
import { signOut } from '@/app/(login)/actions'
import { useRouter } from 'next/navigation'
import { CircleIcon } from 'lucide-react'

const menuItems = [
  { href: '/projects', icon: Home, label: 'Home' },
  { href: '/projects', icon: FolderOpen, label: 'Projects' },
  { href: '/chat', icon: MessageSquare, label: 'Chat' },
  { href: '/settings', icon: Settings, label: 'Settings' },
]

export function MobileMenu() {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()
  const { theme, setTheme } = useTheme()
  const router = useRouter()

  const isActive = (href: string) => {
    if (href === '/projects') {
      return pathname === '/projects' || pathname === '/'
    }
    return pathname.startsWith(href)
  }

  const handleSignOut = async () => {
    await signOut()
    setOpen(false)
    router.push('/')
  }

  const toggleTheme = () => {
    setTheme(theme === 'dark' ? 'light' : 'dark')
  }

  return (
    <Sheet open={open} onOpenChange={setOpen}>
      <SheetTrigger asChild>
        <Button
          variant="ghost"
          size="icon"
          className="md:hidden h-9 w-9"
          aria-label="Open menu"
        >
          <Menu className="h-5 w-5" />
        </Button>
      </SheetTrigger>
      <SheetContent side="left" className="w-[280px] sm:w-[320px]">
        <SheetHeader>
          <SheetTitle className="flex items-center gap-2">
            <CircleIcon className="h-6 w-6 text-orange-500" />
            <span>Product Helper</span>
          </SheetTitle>
        </SheetHeader>

        <nav className="mt-8 flex flex-col gap-2">
          {menuItems.map((item) => {
            const active = isActive(item.href)
            return (
              <Link
                key={item.label}
                href={item.href}
                onClick={() => setOpen(false)}
                className={cn(
                  "flex items-center gap-3 px-3 py-3 rounded-lg",
                  "transition-colors duration-200",
                  active
                    ? "bg-primary/10 text-primary font-medium"
                    : "text-muted-foreground hover:bg-muted hover:text-foreground"
                )}
              >
                <item.icon className="h-5 w-5" />
                <span>{item.label}</span>
              </Link>
            )
          })}

          <hr className="my-4 border-border" />

          {/* Theme toggle */}
          <button
            onClick={toggleTheme}
            className={cn(
              "flex items-center gap-3 px-3 py-3 rounded-lg w-full",
              "text-muted-foreground hover:bg-muted hover:text-foreground",
              "transition-colors duration-200"
            )}
          >
            {theme === 'dark' ? (
              <Sun className="h-5 w-5" />
            ) : (
              <Moon className="h-5 w-5" />
            )}
            <span>{theme === 'dark' ? 'Light Mode' : 'Dark Mode'}</span>
          </button>

          {/* Sign out */}
          <button
            onClick={handleSignOut}
            className={cn(
              "flex items-center gap-3 px-3 py-3 rounded-lg w-full",
              "text-destructive hover:bg-destructive/10",
              "transition-colors duration-200"
            )}
          >
            <LogOut className="h-5 w-5" />
            <span>Sign Out</span>
          </button>
        </nav>
      </SheetContent>
    </Sheet>
  )
}
```

2. Update `app/(dashboard)/layout.tsx`:

Add imports at top:
```typescript
import { BottomNav } from '@/components/navigation/bottom-nav'
import { MobileMenu } from '@/components/navigation/mobile-menu'
```

Update the Header component - add MobileMenu button before the logo:
```typescript
function Header() {
  const { data: user } = useSWR<User>('/api/user', fetcher);

  return (
    <header className="border-b" style={{ borderColor: 'var(--border)' }}>
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        {/* Mobile menu button - only visible on mobile */}
        {user && <MobileMenu />}

        <Link href="/" className="flex items-center">
          <CircleIcon className="h-6 w-6 text-orange-500" />
          <span className="ml-2 text-xl font-semibold" style={{ color: 'var(--text-primary)' }}>Product Helper</span>
        </Link>

        {/* Desktop Navigation - hidden on mobile */}
        {user && (
          <nav className="hidden md:flex items-center space-x-6">
            {/* ... existing nav links ... */}
          </nav>
        )}

        <div className="flex items-center space-x-4">
          <ModeToggle />
          <Suspense fallback={<div className="h-9" />}>
            <UserMenu />
          </Suspense>
        </div>
      </div>
    </header>
  );
}
```

Add BottomNav at the end of the Layout component, with padding adjustment:
```typescript
export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <section className="flex flex-col h-screen">
      <Header />
      {/* Add bottom padding on mobile to account for bottom nav */}
      <div className="flex-1 min-h-0 overflow-hidden pb-16 md:pb-0">
        {children}
      </div>
      <BottomNav />
    </section>
  );
}
```

IMPORTANT: Add `pb-16 md:pb-0` to the main content area to prevent bottom nav from overlapping content.
  </action>
  <verify>
    - `npm run dev` succeeds
    - On mobile viewport (< 768px):
      - Hamburger menu icon visible in header
      - Tapping opens slide-out drawer with nav items
      - Bottom nav visible with 4 icons
      - Bottom nav highlights current route
    - On desktop viewport (>= 768px):
      - Hamburger menu hidden
      - Bottom nav hidden
      - Existing header nav visible
    - Content doesn't get hidden behind bottom nav
  </verify>
  <done>
    - MobileMenu with hamburger trigger and drawer navigation
    - BottomNav integrated at page bottom (mobile only)
    - Dashboard layout updated with both navigation components
    - Content area has proper padding to avoid overlap
  </done>
</task>

</tasks>

<verification>
1. Responsive testing:
   - Chrome DevTools > Toggle device toolbar
   - Test at 375px (iPhone), 768px (iPad), 1024px+ (desktop)
   - Verify correct nav shows at each breakpoint

2. Navigation functionality:
   - Each bottom nav item navigates to correct route
   - Active state updates on navigation
   - Mobile menu items navigate and close drawer

3. Visual check:
   - Bottom nav has proper spacing and touch targets
   - Mobile menu has clean slide-in animation
   - No layout shift when components appear/disappear

4. Accessibility:
   - Tab through bottom nav items
   - Screen reader announces nav items correctly
   - Mobile menu can be closed with Escape key
</verification>

<success_criteria>
- Bottom nav visible on mobile (< 768px), hidden on desktop
- Mobile menu hamburger visible on mobile, hidden on desktop
- Active route highlighted in both bottom nav and mobile menu
- Content area properly padded to avoid bottom nav overlap
- iOS safe area respected (no content behind home indicator)
- Theme toggle works from mobile menu
- Sign out works from mobile menu
</success_criteria>

<output>
After completion, create `.planning/phases/03-mobile-first-web-revamp/03-03-SUMMARY.md`
</output>
