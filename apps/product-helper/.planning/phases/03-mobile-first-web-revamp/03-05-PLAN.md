---
phase: 03-mobile-first-web-revamp
plan: 05
type: execute
wave: 3
depends_on: ["03-03", "03-04"]
files_modified:
  - app/(dashboard)/layout.tsx
  - app/(dashboard)/projects/page.tsx
  - components/projects/project-card.tsx
  - lib/hooks/use-keyboard-shortcuts.ts
autonomous: true
subsystem: ui
agent: ui-ux-engineer

must_haves:
  truths:
    - "Desktop users can use keyboard shortcuts for common actions"
    - "Dashboard displays multi-column layout on large screens"
    - "Project cards show additional details on desktop hover"
    - "Desktop sidebar navigation is enhanced with visual hierarchy"
  artifacts:
    - path: "lib/hooks/use-keyboard-shortcuts.ts"
      provides: "Global keyboard shortcut handler"
      exports: ["useKeyboardShortcuts"]
    - path: "components/projects/project-card.tsx"
      provides: "Enhanced project card with desktop hover states"
      exports: ["ProjectCard"]
  key_links:
    - from: "app/(dashboard)/layout.tsx"
      to: "lib/hooks/use-keyboard-shortcuts.ts"
      via: "Keyboard shortcuts hook"
      pattern: "useKeyboardShortcuts"
---

<objective>
Enhance desktop experience with improved navigation, keyboard shortcuts, and multi-column layouts.

Purpose: While the mobile-first approach ensures mobile works well, desktop users benefit from features that utilize larger screens and keyboard input. This plan adds desktop-specific enhancements without breaking mobile.

Output:
- Keyboard shortcuts for common actions (Cmd/Ctrl+K for search, etc.)
- Enhanced dashboard layout for large screens
- Improved project cards with hover states
- Better visual hierarchy in navigation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-1.1.md
@.planning/STATE.md
@.planning/phases/03-mobile-first-web-revamp/03-RESEARCH.md
@.planning/phases/03-mobile-first-web-revamp/03-03-SUMMARY.md
@.planning/phases/03-mobile-first-web-revamp/03-04-SUMMARY.md

# Files to reference/modify
@app/(dashboard)/layout.tsx
@app/(dashboard)/projects/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create keyboard shortcuts hook</name>
  <files>
    lib/hooks/use-keyboard-shortcuts.ts
  </files>
  <action>
Create `lib/hooks/use-keyboard-shortcuts.ts`:

```typescript
'use client'

import { useEffect, useCallback } from 'react'
import { useRouter } from 'next/navigation'

interface Shortcut {
  key: string
  ctrl?: boolean
  meta?: boolean
  shift?: boolean
  alt?: boolean
  action: () => void
  description: string
}

/**
 * Hook to register and handle keyboard shortcuts
 * @param shortcuts - Array of shortcut definitions
 */
export function useKeyboardShortcuts(shortcuts: Shortcut[]) {
  const handleKeyDown = useCallback((event: KeyboardEvent) => {
    // Don't trigger shortcuts when typing in inputs
    const target = event.target as HTMLElement
    if (
      target.tagName === 'INPUT' ||
      target.tagName === 'TEXTAREA' ||
      target.isContentEditable
    ) {
      return
    }

    for (const shortcut of shortcuts) {
      const ctrlOrMeta = shortcut.ctrl || shortcut.meta
      const modifierMatch =
        (ctrlOrMeta ? event.ctrlKey || event.metaKey : true) &&
        (shortcut.shift ? event.shiftKey : !event.shiftKey) &&
        (shortcut.alt ? event.altKey : !event.altKey)

      if (
        event.key.toLowerCase() === shortcut.key.toLowerCase() &&
        modifierMatch
      ) {
        event.preventDefault()
        shortcut.action()
        return
      }
    }
  }, [shortcuts])

  useEffect(() => {
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [handleKeyDown])
}

/**
 * Pre-built shortcuts for common app navigation
 */
export function useAppKeyboardShortcuts() {
  const router = useRouter()

  const shortcuts: Shortcut[] = [
    {
      key: 'k',
      meta: true,
      action: () => {
        // TODO: Open command palette/search when implemented
        console.log('Search shortcut triggered')
      },
      description: 'Open search',
    },
    {
      key: 'h',
      meta: true,
      shift: true,
      action: () => router.push('/projects'),
      description: 'Go to home/projects',
    },
    {
      key: 'n',
      meta: true,
      action: () => {
        // TODO: Open new project dialog when implemented
        console.log('New project shortcut triggered')
      },
      description: 'New project',
    },
    {
      key: '/',
      action: () => {
        // Focus search input if exists
        const searchInput = document.querySelector<HTMLInputElement>(
          '[data-search-input]'
        )
        if (searchInput) {
          searchInput.focus()
        }
      },
      description: 'Focus search',
    },
    {
      key: 'Escape',
      action: () => {
        // Blur active element
        if (document.activeElement instanceof HTMLElement) {
          document.activeElement.blur()
        }
      },
      description: 'Clear focus',
    },
  ]

  useKeyboardShortcuts(shortcuts)

  return shortcuts
}

/**
 * Hook for displaying keyboard shortcut hints
 * Returns formatted shortcut strings based on OS
 */
export function useShortcutDisplay() {
  const isMac = typeof window !== 'undefined' &&
    navigator.platform.toLowerCase().includes('mac')

  const formatShortcut = (shortcut: Shortcut): string => {
    const parts: string[] = []
    if (shortcut.ctrl || shortcut.meta) {
      parts.push(isMac ? 'Cmd' : 'Ctrl')
    }
    if (shortcut.shift) parts.push('Shift')
    if (shortcut.alt) parts.push(isMac ? 'Option' : 'Alt')
    parts.push(shortcut.key.toUpperCase())
    return parts.join('+')
  }

  return { isMac, formatShortcut }
}
```

This hook provides:
- Custom shortcut registration
- Pre-built app navigation shortcuts
- OS-aware shortcut display formatting
- Protection against triggering in input fields
  </action>
  <verify>
    - File exists at lib/hooks/use-keyboard-shortcuts.ts
    - Exports useKeyboardShortcuts, useAppKeyboardShortcuts, useShortcutDisplay
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Keyboard shortcuts hook with pre-built navigation shortcuts</done>
</task>

<task type="auto">
  <name>Task 2: Enhance dashboard layout for desktop</name>
  <files>
    app/(dashboard)/layout.tsx
    app/(dashboard)/projects/page.tsx
  </files>
  <action>
1. Update `app/(dashboard)/layout.tsx`:

Add keyboard shortcuts to the layout:
```typescript
import { useAppKeyboardShortcuts } from '@/lib/hooks/use-keyboard-shortcuts'

function DashboardShortcuts() {
  useAppKeyboardShortcuts()
  return null
}

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <section className="flex flex-col h-screen">
      <DashboardShortcuts />
      <Header />
      {/* ... rest of layout */}
    </section>
  );
}
```

Update the Header navigation to show shortcut hints on desktop:
```typescript
{/* Desktop Navigation - show shortcut hints */}
{user && (
  <nav className="hidden md:flex items-center space-x-6">
    <Link
      href="/projects"
      className="text-sm font-medium flex items-center gap-2 group"
      style={{ color: 'var(--text-primary)' }}
    >
      <Home className="h-4 w-4" />
      <span>Home</span>
      <kbd className="hidden lg:inline-flex items-center gap-1 px-1.5 py-0.5 text-xs text-muted-foreground bg-muted rounded">
        <span className="text-[10px]">Cmd</span>
        <span>+</span>
        <span className="text-[10px]">Shift</span>
        <span>+</span>
        <span>H</span>
      </kbd>
    </Link>
    {/* ... other nav items */}
  </nav>
)}
```

2. Update `app/(dashboard)/projects/page.tsx` for multi-column layout:

The projects page should use a responsive grid:
```typescript
<div className={cn(
  "grid gap-4 p-4",
  "grid-cols-1", // Mobile: single column
  "sm:grid-cols-2", // Tablet: 2 columns
  "lg:grid-cols-3", // Desktop: 3 columns
  "xl:grid-cols-4" // Large desktop: 4 columns
)}>
  {projects.map((project) => (
    <ProjectCard key={project.id} project={project} />
  ))}
</div>
```

If the page uses a different structure, adapt the grid layout to the existing component hierarchy.
  </action>
  <verify>
    - `npm run dev` succeeds
    - On desktop:
      - Press Cmd/Ctrl+Shift+H - navigates to projects
      - Keyboard hint shows next to "Home" in nav (on lg+ screens)
    - Projects page shows:
      - 1 column on mobile
      - 2 columns on tablet (sm breakpoint)
      - 3 columns on large screens (lg breakpoint)
      - 4 columns on xl screens
  </verify>
  <done>
    - Keyboard shortcuts active on desktop
    - Dashboard header shows shortcut hints
    - Projects page uses responsive multi-column grid
  </done>
</task>

<task type="auto">
  <name>Task 3: Create enhanced ProjectCard with desktop hover states</name>
  <files>
    components/projects/project-card.tsx
  </files>
  <action>
Create or enhance `components/projects/project-card.tsx`:

```typescript
'use client'

import Link from 'next/link'
import { formatDistanceToNow } from 'date-fns'
import { FolderOpen, MessageSquare, FileText, MoreHorizontal, Trash2, Edit } from 'lucide-react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { useState } from 'react'

interface Project {
  id: string
  name: string
  description?: string | null
  createdAt: Date | string
  updatedAt: Date | string
  messageCount?: number
  artifactCount?: number
}

interface ProjectCardProps {
  project: Project
  onDelete?: (id: string) => void
  onEdit?: (id: string) => void
}

export function ProjectCard({ project, onDelete, onEdit }: ProjectCardProps) {
  const [isHovered, setIsHovered] = useState(false)

  const createdAt = new Date(project.createdAt)
  const timeAgo = formatDistanceToNow(createdAt, { addSuffix: true })

  return (
    <Link
      href={`/projects/${project.id}/chat`}
      className={cn(
        "block rounded-lg border transition-all duration-200",
        "bg-card hover:bg-accent/50",
        "border-border hover:border-primary/50",
        // Desktop: subtle shadow on hover
        "md:hover:shadow-md",
        // Focus visible for keyboard navigation
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"
      )}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className="p-4">
        {/* Header */}
        <div className="flex items-start justify-between gap-2">
          <div className="flex items-center gap-2 min-w-0">
            <FolderOpen className="h-5 w-5 text-primary shrink-0" />
            <h3 className="font-semibold truncate">{project.name}</h3>
          </div>

          {/* Actions - visible on hover (desktop) or always (mobile) */}
          <div
            className={cn(
              "shrink-0 transition-opacity",
              "md:opacity-0 md:group-hover:opacity-100",
              isHovered && "md:opacity-100"
            )}
            onClick={(e) => e.preventDefault()} // Prevent link navigation
          >
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button
                  variant="ghost"
                  size="icon"
                  className="h-8 w-8"
                >
                  <MoreHorizontal className="h-4 w-4" />
                  <span className="sr-only">Actions</span>
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end">
                {onEdit && (
                  <DropdownMenuItem onClick={() => onEdit(project.id)}>
                    <Edit className="h-4 w-4 mr-2" />
                    Edit
                  </DropdownMenuItem>
                )}
                {onDelete && (
                  <DropdownMenuItem
                    onClick={() => onDelete(project.id)}
                    className="text-destructive"
                  >
                    <Trash2 className="h-4 w-4 mr-2" />
                    Delete
                  </DropdownMenuItem>
                )}
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        </div>

        {/* Description - shown on desktop or expanded */}
        {project.description && (
          <p className={cn(
            "mt-2 text-sm text-muted-foreground",
            "line-clamp-2", // Always truncate to 2 lines
            "md:line-clamp-3" // 3 lines on desktop
          )}>
            {project.description}
          </p>
        )}

        {/* Stats - desktop: show on hover, mobile: always show */}
        <div className={cn(
          "mt-4 flex items-center gap-4 text-sm text-muted-foreground",
          "transition-all duration-200"
        )}>
          {project.messageCount !== undefined && (
            <div className="flex items-center gap-1">
              <MessageSquare className="h-4 w-4" />
              <span>{project.messageCount}</span>
            </div>
          )}
          {project.artifactCount !== undefined && (
            <div className="flex items-center gap-1">
              <FileText className="h-4 w-4" />
              <span>{project.artifactCount}</span>
            </div>
          )}
          <span className="text-xs">{timeAgo}</span>
        </div>

        {/* Desktop: Quick actions on hover */}
        <div className={cn(
          "mt-3 flex gap-2 overflow-hidden transition-all duration-200",
          "h-0 opacity-0",
          "md:group-hover:h-auto md:group-hover:opacity-100",
          isHovered && "md:h-auto md:opacity-100"
        )}>
          <Button
            variant="secondary"
            size="sm"
            className="text-xs"
            onClick={(e) => {
              e.preventDefault()
              // Navigate to chat
              window.location.href = `/projects/${project.id}/chat`
            }}
          >
            <MessageSquare className="h-3 w-3 mr-1" />
            Chat
          </Button>
          <Button
            variant="secondary"
            size="sm"
            className="text-xs"
            onClick={(e) => {
              e.preventDefault()
              // Navigate to artifacts/PRD
              window.location.href = `/projects/${project.id}`
            }}
          >
            <FileText className="h-3 w-3 mr-1" />
            View PRD
          </Button>
        </div>
      </div>
    </Link>
  )
}
```

NOTES:
- Uses CSS hover states for desktop enhancement
- Quick actions appear on hover (desktop only)
- Mobile gets clean, touch-friendly design
- Supports keyboard navigation with focus-visible
- Actions dropdown prevents link navigation with e.preventDefault()
  </action>
  <verify>
    - File exists at components/projects/project-card.tsx
    - Component renders project info correctly
    - On desktop:
      - Hover shows shadow effect
      - Hover reveals quick action buttons
      - More menu accessible
    - On mobile:
      - Tapping card navigates to project
      - More menu accessible without hover
    - Keyboard focus shows visible ring
  </verify>
  <done>
    - ProjectCard with desktop hover enhancements
    - Quick action buttons on hover
    - Responsive description truncation
    - Accessible keyboard navigation
  </done>
</task>

</tasks>

<verification>
1. Keyboard shortcuts:
   - Press Cmd/Ctrl+K (logs to console for now)
   - Press Cmd/Ctrl+Shift+H to navigate to projects
   - Press / to focus search (if search input exists)
   - Press Escape to blur active element
   - Shortcuts don't trigger when typing in inputs

2. Desktop layout:
   - Projects grid shows 3-4 columns on wide screens
   - Navigation shows keyboard hints on lg+ screens

3. Project cards:
   - Hover reveals additional actions on desktop
   - Focus ring visible on keyboard navigation
   - Mobile layout is clean without hover effects
   - Actions menu works on both mobile and desktop

4. No regressions:
   - Mobile navigation still works
   - Bottom nav still visible on mobile
   - Dark mode still works
</verification>

<success_criteria>
- Keyboard shortcuts functional on desktop (not in inputs)
- Multi-column grid adapts to screen size
- Project cards show hover states on desktop
- Quick actions accessible via hover and dropdown
- Focus states visible for keyboard users
- No visual regressions on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/03-mobile-first-web-revamp/03-05-SUMMARY.md`
</output>
