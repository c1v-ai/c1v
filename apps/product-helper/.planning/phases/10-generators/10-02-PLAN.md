---
plan: 10-02
name: Infrastructure Specification Agent
wave: 1
autonomous: true
subsystem: langchain
---

# Plan 10-02: Infrastructure Specification Agent

## Objective

Create an AI agent that generates infrastructure specifications based on tech stack and project requirements. This covers hosting, database config, caching, CI/CD, monitoring, and security.

## Context

- Types defined in `lib/db/schema/v2-types.ts` (InfrastructureSpec interface)
- Database column exists: `project_data.infrastructure_spec` (added in Phase 9)
- Pattern to follow: `lib/langchain/agents/tech-stack-agent.ts`

## Tasks

### Task 1: Create Infrastructure Agent

**File:** `lib/langchain/agents/infrastructure-agent.ts`

**Inputs:**
- Project name and description
- Tech stack (from `projectData.techStack`)
- Scale requirements (user count, data volume)
- Compliance requirements (GDPR, SOC2, etc.)

**Outputs (InfrastructureSpec):**
```typescript
{
  hosting: {
    provider: string;        // "vercel" | "aws" | "gcp" | "azure"
    compute: string;         // "serverless" | "containers" | "vms"
    regions: string[];
    autoscaling: boolean;
    estimatedCost: string;
  },
  database: {
    service: string;         // "supabase" | "planetscale" | "rds"
    tier: string;
    backups: string;
    replicas: number;
  },
  caching: {
    service: string;         // "redis" | "memcached" | "edge"
    strategy: string;
    ttl: string;
  },
  cicd: {
    platform: string;        // "github-actions" | "gitlab-ci" | "jenkins"
    stages: string[];
    deploymentStrategy: string;
  },
  monitoring: {
    apm: string;             // "datadog" | "newrelic" | "sentry"
    logging: string;
    alerts: string[];
  },
  security: {
    authentication: string;
    secrets: string;
    waf: boolean;
    ddosProtection: boolean;
  },
  estimatedMonthlyCost: string;
}
```

**Implementation:**
1. Create Zod schema for structured output
2. Build prompt template with tech stack context
3. Use GPT-4o with structured output
4. Add cost estimation logic

### Task 2: Create API Route

**File:** `app/api/projects/[id]/infrastructure/route.ts`

- GET: Return existing infrastructure spec
- POST: Generate new spec from tech stack + requirements

### Task 3: Add Zod Validators

**File:** `lib/db/schema/v2-validators.ts` (append)

Add Zod schemas for InfrastructureSpec and nested types.

## Dependencies

None - can run in parallel with other Wave 1 plans.

## Deliverables

- [ ] `lib/langchain/agents/infrastructure-agent.ts` created
- [ ] `app/api/projects/[id]/infrastructure/route.ts` created
- [ ] Zod validators added to v2-validators.ts
- [ ] Agent generates valid InfrastructureSpec
