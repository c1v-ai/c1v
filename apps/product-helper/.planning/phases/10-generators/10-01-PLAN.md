---
plan: 10-01
name: API Specification Route
wave: 1
autonomous: true
subsystem: api
---

# Plan 10-01: API Specification Route

## Objective

Create the API route for the existing API specification agent. The agent (`lib/langchain/agents/api-spec-agent.ts`) already exists - this plan adds the HTTP endpoint to expose it.

## Context

- Agent exists: `lib/langchain/agents/api-spec-agent.ts`
- OpenAPI export exists: `lib/mcp/api-spec-openapi-export.ts`
- Database column exists: `project_data.api_specification` (added in Phase 9)
- Types exist: `lib/types/api-specification.ts`

## Tasks

### Task 1: Create API Route

**File:** `app/api/projects/[id]/api-spec/route.ts`

```typescript
// GET - Return existing API specification
// POST - Generate new API specification from project data
// Query params: ?format=json|openapi (default: json)
```

**Implementation:**
1. GET handler: Read `projectData.apiSpecification` from database
2. POST handler:
   - Load project data (useCases, dataEntities, techStack)
   - Call `generateAPISpecification()` from api-spec-agent
   - Save to database
   - Return generated spec
3. Support `?format=openapi` query param for OpenAPI 3.0 export

### Task 2: Add Route Tests

**File:** `app/api/projects/[id]/api-spec/__tests__/route.test.ts`

Test cases:
- GET returns 404 if no spec exists
- GET returns existing spec
- POST generates new spec
- POST with format=openapi returns OpenAPI format
- POST updates existing spec

## Dependencies

None - can run in parallel with other Wave 1 plans.

## Deliverables

- [ ] `app/api/projects/[id]/api-spec/route.ts` created
- [ ] Route handles GET/POST with format parameter
- [ ] Tests pass
