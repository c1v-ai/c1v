---
phase: 06-content-section-views-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(login)/actions.ts
  - components/projects/sections/system-overview-section.tsx
  - lib/utils/vision.ts
  - components/onboarding/welcome-onboarding.tsx
autonomous: true
subsystem: ui

must_haves:
  truths:
    - "After sign-in, returning users land on /welcome-test (not /projects)"
    - "Vision statement on overview page shows user's description without [Mode: ...] prefix or system context"
    - "PRD-SPEC Validation section is NOT visible to users on the overview page (dev-only)"
    - "System overview actor table rows do NOT highlight green on hover"
    - "Chat auto-send message does NOT contain [Mode:...] prefix or system context metadata"
  artifacts:
    - path: "lib/utils/vision.ts"
      provides: "stripVisionMetadata() helper function"
      exports: ["stripVisionMetadata"]
    - path: "app/(login)/actions.ts"
      provides: "Post-login redirect to /welcome-test"
      contains: "redirect('/welcome-test')"
  key_links:
    - from: "lib/utils/vision.ts"
      to: "app/(dashboard)/projects/[id]/page.tsx"
      via: "Will be imported by 06-04 when it rewrites the overview page"
      pattern: "stripVisionMetadata"
---

<objective>
Apply 3 quick UX fixes across the product-helper app: change post-login redirect to /welcome-test for all users (UX-01), create stripVisionMetadata utility for display-side cleanup (UX-02 prep), hide PRD-SPEC Validation from non-dev environments (UX-08), and remove green hover highlighting from system overview actor rows (UX-09).

NOTE: The stripVisionMetadata() utility is created here but NOT applied to page.tsx here. Plan 06-04 rewrites the overview page and integrates stripVisionMetadata at that point. This avoids a file conflict on page.tsx.

Purpose: These are low-risk, high-impact UX improvements that eliminate user-facing jargon, fix navigation, and clean up visual noise. They establish the baseline for the larger Wave 2 work.
Output: 3 targeted code changes + 1 new utility function.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-content-section-views-ux-polish/06-RESEARCH.md

Key file locations:
- Post-login redirect: `app/(login)/actions.ts` line 105
- New signup redirect: `app/(login)/actions.ts` line 237 (already goes to /welcome-test)
- Overview page: `app/(dashboard)/projects/[id]/page.tsx` (196 lines)
- Vision metadata injection: `components/onboarding/welcome-onboarding.tsx` lines 53-63
- Green hover: `components/projects/sections/system-overview-section.tsx` line 118
- Chat auto-send: `components/project/project-chat-provider.tsx` lines 186-212 (already strips mode prefix for auto-send)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Post-login redirect + vision metadata stripping utility</name>
  <files>
    app/(login)/actions.ts
    lib/utils/vision.ts
    components/onboarding/welcome-onboarding.tsx
  </files>
  <action>
    **UX-01: Post-login redirect**
    In `app/(login)/actions.ts`, change line 105 from `redirect('/projects')` to `redirect('/welcome-test')`. This makes returning users land on the welcome page, matching new user behavior (line 237 already redirects to `/welcome-test`).

    **UX-02: Vision metadata stripping utility**
    1. Create `lib/utils/vision.ts` with a `stripVisionMetadata()` function:
       - Removes `[Mode: Defined Scope]` or `[Mode: Guided Discovery]` prefix line
       - Removes `---` separator and all system context text after it
       - Handles null/undefined input gracefully (return empty string)
       - Trims whitespace
       - Pattern: `vision.replace(/^\[Mode:[^\]]*\]\s*\n*/m, '').replace(/\n---\n[\s\S]*$/, '').trim()`

    2. In `components/onboarding/welcome-onboarding.tsx`, do NOT change the storage format yet (existing projects depend on it). The stripping happens at display time only. Leave the `modePrefix` and `modeContext` logic as-is for now -- the display-side fix handles both legacy and future data.

    **UX-02 verification: Chat messages**
    Verify that `components/project/project-chat-provider.tsx` lines 186-212 already strips metadata from the auto-send message. The code extracts `userDescription` by finding the mode line and separator, then sends only the description text. Confirm this is working correctly -- if any metadata leaks through to chat message content, add stripping logic there too.

    **Styling convention:** Use CSS variables (not Tailwind color classes) for any text colors per project conventions.
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without new errors
    - Grep `actions.ts` for `redirect('/welcome-test')` on line 105 area
    - Grep `lib/utils/vision.ts` for `stripVisionMetadata` export
    - Run: `node -e "const {stripVisionMetadata} = require('./lib/utils/vision'); console.log(stripVisionMetadata('[Mode: Defined Scope]\n\nMy product description\n\n---\nUser has a defined scope.'))"` should output "My product description"
    - Grep `project-chat-provider.tsx` for `modeLineIndex` to confirm auto-send already strips metadata
  </verify>
  <done>
    - Returning users redirected to /welcome-test after sign-in
    - `stripVisionMetadata()` correctly strips metadata from both legacy and clean vision strings
    - Chat auto-send confirmed to NOT leak metadata into messages
    - No TypeScript compilation errors introduced
  </done>
</task>

<task type="auto">
  <name>Task 2: Validation hide (dev-only) + green hover removal</name>
  <files>
    app/(dashboard)/projects/[id]/page.tsx
    components/projects/sections/system-overview-section.tsx
  </files>
  <action>
    **UX-08: Hide validation from non-dev**
    In `app/(dashboard)/projects/[id]/page.tsx`, wrap the `<ValidationReport>` component (lines 164-170) in a `process.env.NODE_ENV === 'development'` conditional. This is a server component so the check happens at render time and the component is tree-shaken in production builds.

    ```tsx
    {process.env.NODE_ENV === 'development' && (
      <ValidationReport
        projectId={project.id}
        projectName={project.name}
        initialValidationScore={project.validationScore || 0}
      />
    )}
    ```

    **IMPORTANT: Do NOT add stripVisionMetadata to page.tsx in this task.** Plan 06-04 rewrites the entire ProjectDetail component and will integrate stripVisionMetadata at that point. Adding it here would create a file conflict since 06-04 replaces the section that would use it.

    **UX-09: Remove green hover highlighting**
    In `components/projects/sections/system-overview-section.tsx`, remove the `'hover:bg-muted/50 transition-colors'` class from the actor table row `className` on line 118. Keep the `'border-b last:border-b-0'` class. The row should remain static on hover.

    Also check for similar hover patterns on data entity cards in the same file (~line 328). If `hover:bg-muted/50` appears there too, remove it as well. The voice notes specifically called out "green hover highlighting" as confusing.
  </action>
  <verify>
    - `npx tsc --noEmit` compiles without new errors
    - Grep `page.tsx` for `NODE_ENV` to confirm validation is gated
    - Grep `page.tsx` to confirm NO `stripVisionMetadata` import (that belongs in 06-04)
    - Grep `system-overview-section.tsx` for `hover:bg-muted` should return NO results
    - `pnpm build` succeeds (confirms server component compatibility)
  </verify>
  <done>
    - ValidationReport only renders in development
    - No green hover highlight on system overview actor rows or entity cards
    - page.tsx NOT modified beyond the ValidationReport gate (no stripVisionMetadata here)
    - Build succeeds
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- no new TypeScript errors
2. `pnpm build` -- production build succeeds
3. Manual check: sign in and confirm redirect goes to /welcome-test page
4. Manual check: ValidationReport not visible on overview (unless NODE_ENV=development)
5. Manual check: system overview actors table rows don't highlight on hover
6. Grep check: `project-chat-provider.tsx` already strips metadata from auto-send (no leak)
</verification>

<success_criteria>
- UX-01 applied (post-login redirect)
- UX-02 utility created (stripVisionMetadata), chat metadata confirmed clean
- UX-08 applied (validation dev-only)
- UX-09 applied (green hover removed)
- TypeScript compiles, build passes
- Zero file conflicts with 06-04 (page.tsx only gets NODE_ENV gate, not stripVisionMetadata)
</success_criteria>

<output>
After completion, create `.planning/phases/06-content-section-views-ux-polish/06-01-SUMMARY.md`
</output>
